"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.makeLocate = void 0;
const driver_1 = require("@applitools/driver");
const take_screenshot_1 = require("./utils/take-screenshot");
function makeLocate({ spec, core, target: defaultTarget, logger: defaultLogger, }) {
    return async function locate({ target = defaultTarget, settings, logger = defaultLogger, } = {}) {
        logger.log('Command "locate" is called with settings', settings);
        if (!(spec === null || spec === void 0 ? void 0 : spec.isDriver(target))) {
            return core.locate({ target: target, settings: settings, logger });
        }
        // TODO driver custom config
        const driver = await (0, driver_1.makeDriver)({ spec, driver: target, logger });
        const screenshot = await (0, take_screenshot_1.takeScreenshot)({ driver, settings, logger });
        const baseTarget = {
            image: await screenshot.image.toPng(),
        };
        const results = await core.locate({ target: baseTarget, settings: settings, logger });
        return results;
    };
}
exports.makeLocate = makeLocate;
